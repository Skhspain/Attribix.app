// prisma/schema.postgres.prisma

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // PgBouncer on 5432 (runtime)
  directUrl = env("DIRECT_URL")     // Direct Postgres on 5433 (migrations/db push)
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

/**
 * Shopify session storage table expected by
 * @shopify/shopify-app-session-storage-prisma
 */
model Session {
  // Core session fields
  id          String   @id @db.VarChar(255)
  shop        String   @db.VarChar(255)
  state       String?  @db.VarChar(255)
  isOnline    Boolean
  scope       String?  @db.VarChar(255)
  expires     DateTime?
  accessToken String?  @db.Text
  userId      BigInt?
  firstParty  Boolean?

  // Associated user fields for ONLINE tokens (required by storage â€“ optional here)
  firstName     String?  @db.VarChar(255)
  lastName      String?  @db.VarChar(255)
  email         String?  @db.VarChar(255)
  accountOwner  Boolean?
  locale        String?  @db.VarChar(64)
  collaborator  Boolean?
  emailVerified Boolean?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Session")
}
